# This is a Databricks asset bundle definition for ADBCelebalTech.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: ADBCelebalTech
  uuid: 17c5db6f-3718-4c2e-b9bb-58b990929569

# Artifacts configuration
artifacts:
  python_artifact:
    type: whl
    build: uv build --wheel

# Include resource configurations
include:
  - resources/*.yml
  - resources/*/*.yml

# Variables that can be overridden per target
variables:
  # Catalog and Schema Configuration
  catalog_name:
    description: "Unity Catalog name"
    default: "dev_catalog"
  
  schema_name:
    description: "Schema name in the catalog"
    default: "default"
  
  # Azure Storage Configuration
  storage_account:
    description: "Azure Storage Account name"
    default: "devstorageaccount"
  
  container_name:
    description: "Azure Storage Container name"
    default: "raw-data"
  
  # Environment Configuration
  env_name:
    description: "Environment name (dev/uat/prod)"
    default: "development"
  
  # Notification Configuration
  notification_email:
    description: "Email for job notifications"
    default: "dev-team@celebaltech.com"
  
  # Cluster Configuration
  job_cluster_size:
    description: "Cluster node type for jobs"
    default: "Standard_DS3_v2"
  
  max_workers:
    description: "Maximum number of workers for job clusters"
    default: 2
  
  min_workers:
    description: "Minimum number of workers for job clusters"
    default: 1

# Target environments
targets:
  # Development Environment
  dev:
    mode: development
    default: true
    
    workspace:
      host: https://adb-4444264018179996.16.azuredatabricks.net
    
    presets:
      # Set dynamic_version: true on all artifacts of type "whl".
      # This makes "bundle deploy" add a timestamp to wheel's version before uploading,
      # new wheel takes over the previous installation even if actual wheel version is unchanged.
      artifacts_dynamic_version: true
    
    # Development-specific variables
    variables:
      catalog_name: "dev_catalog"
      schema_name: "dev_schema"
      storage_account: "devstorageaccount"
      container_name: "dev-raw-data"
      env_name: "development"
      notification_email: "dev-team@celebaltech.com"
      job_cluster_size: "Standard_DS3_v2"
      max_workers: 2
      min_workers: 1
  
  # UAT Environment
  uat:
    mode: production
    
    workspace:
      host: https://adb-957375356088406.6.azuredatabricks.net
      # Deploy to specific workspace path
      root_path: /Workspace/Users/himaan.celebal1@outlook.com/.bundle/${bundle.name}/${bundle.target}
    
    permissions:
      - user_name: himaan.celebal1@outlook.com
        level: CAN_MANAGE
      - service_principal_name: 47ad5252-9aee-4de8-85e2-62433b16894f
        level: CAN_MANAGE
    
    # UAT-specific variables
    variables:
      catalog_name: "uat_catalog"
      schema_name: "uat_schema"
      storage_account: "uatstorageaccount"
      container_name: "uat-raw-data"
      env_name: "uat"
      notification_email: "uat-team@celebaltech.com"
      job_cluster_size: "Standard_DS4_v2"
      max_workers: 4
      min_workers: 2
  
  # Production Environment (for future use)
  prod:
    mode: production
    
    workspace:
      host: https://adb-PROD-WORKSPACE-ID.azuredatabricks.net  # Update with actual prod workspace
      root_path: /Workspace/Users/himaan.celebal1@outlook.com/.bundle/${bundle.name}/${bundle.target}
    
    permissions:
      - user_name: himaan.celebal1@outlook.com
        level: CAN_MANAGE
      - service_principal_name: 47ad5252-9aee-4de8-85e2-62433b16894f
        level: CAN_MANAGE
    
    # Production-specific variables
    variables:
      catalog_name: "prod_catalog"
      schema_name: "prod_schema"
      storage_account: "prodstorageaccount"
      container_name: "prod-raw-data"
      env_name: "production"
      notification_email: "prod-team@celebaltech.com"
      job_cluster_size: "Standard_DS5_v2"
      max_workers: 8
      min_workers: 4
